use raylib_ffi::{
  consts::colors,
  core::{
    begin_drawing, clear_background, close_window, end_drawing, init_window, set_target_fps,
    window_should_close,
  },
  enums::PixelFormat,
  structs::{Color, Image},
  text::draw_text,
  texture::{
    draw_texture, fade, load_image_raw, load_texture_from_image, unload_image, unload_texture,
  },
};

fn main() {
  const SCREEN_WIDTH: i32 = 800;
  const SCREEN_HEIGHT: i32 = 450;

  init_window(
    SCREEN_WIDTH,
    SCREEN_HEIGHT,
    "raylib [textures] example - raw data",
  );

  let fudesumi_raw = load_image_raw(
    "resources/fudesumi.raw",
    384,
    512,
    PixelFormat::UncompressedR8G8B8A8,
    0,
  );
  let fudesumi = load_texture_from_image(fudesumi_raw);
  unload_image(fudesumi_raw);

  let width = 960;
  let height = 480;

  let mut pixels: Vec<Color> = vec![];

  for y in 0..height {
    for x in 0..width {
      if (x / 32 + y / 32) % 2 == 0 {
        pixels.push(colors::ORANGE);
      } else {
        pixels.push(colors::GOLD);
      }
    }
  }

  let data = pixels.as_mut_ptr().cast();

  // prevent Rust from freeing it
  std::mem::forget(pixels);

  let checked_img = Image {
    data: data,
    width: width as i32,
    height: height as i32,
    format: PixelFormat::UncompressedR8G8B8A8,
    mipmaps: 1,
  };

  let checked = load_texture_from_image(checked_img);
  unload_image(checked_img);

  set_target_fps(60);

  while !window_should_close() {
    begin_drawing();

    clear_background(colors::RAYWHITE);

    draw_texture(
      checked,
      SCREEN_WIDTH / 2 - checked.width / 2,
      SCREEN_HEIGHT / 2 - checked.height / 2,
      fade(colors::WHITE, 0.5),
    );
    draw_texture(fudesumi, 430, -30, colors::WHITE);

    draw_text("CHECKED TEXTURE ", 84, 85, 30, colors::BROWN);
    draw_text("GENERATED by CODE", 72, 148, 30, colors::BROWN);
    draw_text("and RAW IMAGE LOADING", 46, 210, 30, colors::BROWN);

    draw_text(
      "(c) Fudesumi sprite by Eiden Marsal",
      310,
      SCREEN_HEIGHT - 20,
      10,
      colors::BROWN,
    );

    end_drawing();
  }

  unload_texture(checked);
  unload_texture(fudesumi);

  close_window();
}
